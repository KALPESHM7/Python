{% extends "base.html" %}
{% block content %}
  <h2>{{ poll.title }}</h2>
  <div class="content-section">

    {% if not has_voted %}
      <!-- Voting form -->
      <form method="POST">
        <ul class="list">
          {% for option in poll.options %}
            <li class="mb-2">
              <label>
                <input type="radio" name="option_id" value="{{ option.id }}">
                {{ option.text }}
              </label>
            </li>
          {% endfor %}
        </ul>
        <button type="submit" class="btn btn-custom">Vote</button>
      </form>
    {% else %}
      <p class="muted">✅ You already voted on this poll.</p>
      <!-- Back to Home after voting -->
      <a href="{{ url_for('web.index') }}" class="btn btn-secondary mt-2">← Back to Home</a>
    {% endif %}
  </div>

  <hr>

  <!-- Results section (owner only) -->
  {% if current_user.is_authenticated and current_user.id == poll.owner_id %}
    <div class="content-section">
      <h4>Results (Owner View)</h4>
      <ul class="list">
        {% for option in poll.options %}
          <li>
            {{ option.text }} - <strong>{{ option.votes }}</strong> votes
          </li>
        {% endfor %}
      </ul>
      <!-- Back to Home for owner too -->
      <a href="{{ url_for('web.index') }}" class="btn btn-secondary mt-2">← Back to Home</a>
    </div>
    <hr>
  {% endif %}

  <!-- Share link -->
  <div class="content-section">
    <h5>Share this poll</h5>
    <p>
      Public link:
      <code>{{ request.host_url[:-1] + url_for('web.poll_public', poll_id=poll.id) }}</code>
    </p>
  </div>

  <hr>

  <!-- Delete option (only for owner) -->
  {% if current_user.is_authenticated and current_user.id == poll.owner_id %}
    <form action="{{ url_for('web.delete_poll', poll_id=poll.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this poll?');">
      <button type="submit" class="btn btn-danger">Delete Poll</button>
    </form>
  {% endif %}
{% endblock %}
